import{J as K,s as O,a as T,j as R}from"./styled-components.browser.esm-5c00f201.js";import{r as x}from"./index-76fb7be0.js";import{c as Y,g as Z}from"./_commonjsHelpers-de833af9.js";import{C as ee}from"./index-2384fde8.js";import"./index-d3ea75b5.js";var F={exports:{}};(function(s,y){(function(c,a){s.exports=a(x)})(Y,function(u){return function(c){var a={};function r(i){if(a[i])return a[i].exports;var l=a[i]={i,l:!1,exports:{}};return c[i].call(l.exports,l,l.exports,r),l.l=!0,l.exports}return r.m=c,r.c=a,r.d=function(i,l,g){r.o(i,l)||Object.defineProperty(i,l,{enumerable:!0,get:g})},r.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},r.t=function(i,l){if(l&1&&(i=r(i)),l&8||l&4&&typeof i=="object"&&i&&i.__esModule)return i;var g=Object.create(null);if(r.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:i}),l&2&&typeof i!="string")for(var C in i)r.d(g,C,(function(S){return i[S]}).bind(null,C));return g},r.n=function(i){var l=i&&i.__esModule?function(){return i.default}:function(){return i};return r.d(l,"a",l),l},r.o=function(i,l){return Object.prototype.hasOwnProperty.call(i,l)},r.p="",r(r.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(c,a,r){r.r(a);var i=r("react"),l=function(){var m=function(d,e){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])},m(d,e)};return function(d,e){m(d,e);function t(){this.constructor=d}d.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),g=function(){return g=Object.assign||function(m){for(var d,e=1,t=arguments.length;e<t;e++){d=arguments[e];for(var n in d)Object.prototype.hasOwnProperty.call(d,n)&&(m[n]=d[n])}return m},g.apply(this,arguments)},C=function(m,d){var e={};for(var t in m)Object.prototype.hasOwnProperty.call(m,t)&&d.indexOf(t)<0&&(e[t]=m[t]);if(m!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(m);n<t.length;n++)d.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(m,t[n])&&(e[t[n]]=m[t[n]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(d){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,n){e.call(navigator,d,t,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function S(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var k=function(m){l(d,m);function d(e){var t=m.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return d.prototype.componentDidMount=function(){var e=this,t=e.state,n=e.props;if(this.unmounted=!1,!S()){n.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),n.children&&typeof n.children!="function"&&console.warn("children must be a function")},d.prototype.componentDidUpdate=function(e){var t=this.props;if(!S()){t.onUserMediaError("getUserMedia not supported");return}var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),o=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),v=e.minScreenshotWidth!==t.minScreenshotWidth,f=e.minScreenshotHeight!==t.minScreenshotHeight;(o||v||f)&&(this.canvas=null,this.ctx=null),(n||o)&&(this.stopAndCleanup(),this.requestUserMedia())},d.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},d.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},d.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(d.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},d.prototype.getScreenshot=function(e){var t=this,n=t.state,o=t.props;if(!n.hasUserMedia)return null;var v=this.getCanvas(e);return v&&v.toDataURL(o.screenshotFormat,o.screenshotQuality)},d.prototype.getCanvas=function(e){var t=this,n=t.state,o=t.props;if(!this.video||!n.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var v=this.video.videoWidth,f=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var p=v/f;v=o.minScreenshotWidth||this.video.clientWidth,f=v/p,o.minScreenshotHeight&&f<o.minScreenshotHeight&&(f=o.minScreenshotHeight,v=f*p)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||v,this.canvas.height=(e==null?void 0:e.height)||f,this.ctx=this.canvas.getContext("2d")}var b=this,M=b.ctx,h=b.canvas;return M&&h&&(h.width=(e==null?void 0:e.width)||h.width,h.height=(e==null?void 0:e.height)||h.height,o.mirrored&&(M.translate(h.width,0),M.scale(-1,1)),M.imageSmoothingEnabled=o.imageSmoothing,M.drawImage(this.video,0,0,(e==null?void 0:e.width)||h.width,(e==null?void 0:e.height)||h.height),o.mirrored&&(M.scale(-1,1),M.translate(-h.width,0))),h},d.prototype.requestUserMedia=function(){var e=this,t=this.props,n=function(f,p){var b={video:typeof p<"u"?p:!0};t.audio&&(b.audio=typeof f<"u"?f:!0),e.requestUserMediaId++;var M=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(b).then(function(h){e.unmounted||M!==e.requestUserMediaId?d.stopMediaStream(h):e.handleUserMedia(null,h)}).catch(function(h){e.handleUserMedia(h)})};if("mediaDevices"in navigator)n(t.audioConstraints,t.videoConstraints);else{var o=function(f){return{optional:[{sourceId:f}]}},v=function(f){var p=f.deviceId;return typeof p=="string"?p:Array.isArray(p)&&p.length>0?p[0]:typeof p=="object"&&p.ideal?p.ideal:null};MediaStreamTrack.getSources(function(f){var p=null,b=null;f.forEach(function(_){_.kind==="audio"?p=_.id:_.kind==="video"&&(b=_.id)});var M=v(t.audioConstraints);M&&(p=M);var h=v(t.videoConstraints);h&&(b=h),n(o(p),o(b))})}},d.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t){this.setState({hasUserMedia:!1}),n.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},d.prototype.render=function(){var e=this,t=this,n=t.state,o=t.props,v=o.audio;o.forceScreenshotSourceSize,o.onUserMedia,o.onUserMediaError,o.screenshotFormat,o.screenshotQuality,o.minScreenshotWidth,o.minScreenshotHeight,o.audioConstraints,o.videoConstraints,o.imageSmoothing;var f=o.mirrored,p=o.style,b=p===void 0?{}:p,M=o.children,h=C(o,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),_=f?g(g({},b),{transform:(b.transform||"")+" scaleX(-1)"}):b,P={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",g({autoPlay:!0,src:n.src,muted:!v,playsInline:!0,ref:function(I){e.video=I},style:_},h)),M&&M(P))},d.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},d}(i.Component);a.default=k},react:function(c,a){c.exports=u}}).default})})(F);var te=F.exports;const ie=Z(te);var N={},G={},X={},z={};z.getMatches=s=>typeof window<"u"?window.matchMedia(s).matches:!1;X.getMatches=z.getMatches;const{useState:re,useLayoutEffect:oe,useEffect:ne}=x,{getMatches:ae}=X,se=typeof window<"u",de=se?oe:ne,ce=(s="")=>{const[y,u]=re(ae(s));return de(()=>{let c=!0;const a=window.matchMedia(s.replace(/^@media\s*/,"")),r=()=>{c&&u(a.matches)};return a.addListener?a.addListener(r):a.addEventListener("change",r),u(a.matches),()=>{c=!1,a.addListener?a.removeListener(r):a.removeEventListener("change",r)}},[s]),y};G.useMediaQuery=ce;N.useMediaQuery=G.useMediaQuery;var W=N.useMediaQuery;const ue=()=>{let s=!1,y=!1,u=!1,c=!1,a=!1,r=!1;const i=K();return i!=null&&i.breakpoints&&(s=W(i.breakpoints.only("xs")),y=W(i.breakpoints.only("sm")),u=W(i.breakpoints.only("md")),c=W(i.breakpoints.only("lg")),a=W(i.breakpoints.only("xl")),r=W(i.breakpoints.only("xxl"))),{isXs:s,isSm:y,isMd:u,isLg:c,isXl:a,isXxl:r}},le=(s,y=null)=>{const u=x.useRef(y);return x.useEffect(()=>{s&&(typeof s=="function"?s(u.current):s.current=u.current)},[s]),u},fe=s=>{let y={isRunning:!1,callback:s};return async function(...u){y.isRunning||(y.isRunning=!0,await y.callback(...u),y.isRunning=!1)}},Q=(s,y)=>setInterval(fe(s),y),J="user",pe="videoinput",he=async()=>{let s=[];(await navigator.mediaDevices.enumerateDevices()).forEach(c=>{if(c.kind!==pe)return;const a=c;a&&s.push(a)});let u=[];return s.forEach(c=>{const a=c.getCapabilities(),r={inputDeviceInfo:c,mediaTrackCapabilities:a};u.push(r)}),console.log("video inputs",u),u},ve=async()=>{const s=[];return(await he()).forEach(u=>{const c=u.inputDeviceInfo,a=u.mediaTrackCapabilities,r=a.facingMode;if(r&&r.length)r.forEach(i=>{const l={deviceId:c.deviceId,facingMode:i,label:c.label,aspectRatio:a.aspectRatio,width:a.width,height:a.height};s.push(l)});else{const i={deviceId:u.inputDeviceInfo.deviceId,facingMode:J,label:u.inputDeviceInfo.label,aspectRatio:a.aspectRatio,width:a.width,height:a.height};s.push(i)}}),s},ge=O.div`
  position: relative;
  padding: 1rem;
  margin-bottom: 1rem;
  background-color: #1D1E20;
  border-radius: 4px;
`,me=O.div`
  margin-bottom: 10px;
`,ye=O.div`
  position: relative;
`,Me=O(ie)`
  position: relative;
  top: 0;
  left: 0;
`,be=O(ee)`
  float: right;
`,we=O.span`
  font-size: 12px;
  line-height: 1;
`,V=x.forwardRef(({children:s,mirrored:y=!1,onInitialized:u,onSizeChange:c},a)=>{const r=le(a),[i,l]=x.useState(!1),[g,C]=x.useState([]),[S,k]=x.useState(null),{isXs:m,isSm:d,isMd:e,isLg:t,isXl:n,isXxl:o}=ue();let v=640,f=480;m||d?(v=320,f=240):e||t?(v=576,f=432):(n||o)&&(v=640,f=480);let p={facingMode:J,width:{max:v},height:{max:f}};S&&(p.deviceId=S.deviceId,p.facingMode=S.facingMode);let b=g.length;const M=()=>{let I=!1,w=Q(async()=>{const U=r==null?void 0:r.current;if(!U)return;const E=U==null?void 0:U.video;if(E&&E.readyState===4&&!i){if(!I){console.log("initializing video"),I=!0;const L=await ve(),D=L[0];console.log("initializing video input modes",L),C(L),console.log("initializing default video input mode",D),k(D),console.log("initialized video"),l(!0),u==null||u();const B=E.videoWidth,$=E.videoHeight;c==null||c(B,$)}clearInterval(w)}},100)},h=async()=>{const I=r==null?void 0:r.current;if(!I)return;const w=I==null?void 0:I.video;if(!w||w.readyState!==4)return;const U=w.videoWidth,E=w.videoHeight;(w.width!==U||w.height!==E)&&(w.width=U,w.height=E,c==null||c(U,E))},_=()=>{if(!g||!S)return;let w=g.indexOf(S)+1;w>=g.length&&(w=0);const U=g.at(w);U&&k(U)},P=()=>{_()};return x.useEffect(()=>{i?Q(async()=>{await h()},10):M()},[i]),T(ge,{children:[T(me,{children:[S&&R(we,{children:S.label}),b>1&&R(be,{variant:"small",primary:!0,onClick:P,children:"Switch camera"})]}),T(ye,{children:[R(Me,{ref:r,muted:!0,width:v,height:f,mirrored:y,videoConstraints:p}),s]})]})});try{V.displayName="RoboflowWebcam",V.__docgenInfo={description:"",displayName:"RoboflowWebcam",props:{mirrored:{defaultValue:{value:"false"},description:"",name:"mirrored",required:!1,type:{name:"boolean"}},onInitialized:{defaultValue:null,description:"",name:"onInitialized",required:!1,type:{name:"(() => void)"}},onSizeChange:{defaultValue:null,description:"",name:"onSizeChange",required:!1,type:{name:"((width: number, height: number) => void)"}}}}}catch{}const Ce={component:V,title:"gle-roboflow-components/RoboflowWebcam",argTypes:{}},Se=O.div`
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  margin: 1rem 0;
`,Ue=s=>R(Se,{children:R(V,{})}),j=s=>R(Ue,{...s});j.args={};var A,H,q;j.parameters={...j.parameters,docs:{...(A=j.parameters)==null?void 0:A.docs,source:{originalSource:"(args: RoboflowWebcamProps) => <StoryTemplate {...args} />",...(q=(H=j.parameters)==null?void 0:H.docs)==null?void 0:q.source}}};const We=["Default"];export{j as Default,We as __namedExportsOrder,Ce as default};
//# sourceMappingURL=RoboflowWebcam.stories-d28470cf.js.map
