import{J,s as E,a as P,j as W}from"./styled-components.browser.esm-5c00f201.js";import{r as x}from"./index-76fb7be0.js";import{c as B,g as $}from"./_commonjsHelpers-de833af9.js";import{C as K}from"./index-2384fde8.js";import"./index-d3ea75b5.js";var q={exports:{}};(function(s,m){(function(l,r){s.exports=r(x)})(B,function(u){return function(l){var r={};function a(i){if(r[i])return r[i].exports;var c=r[i]={i,l:!1,exports:{}};return l[i].call(c.exports,c,c.exports,a),c.l=!0,c.exports}return a.m=l,a.c=r,a.d=function(i,c,M){a.o(i,c)||Object.defineProperty(i,c,{enumerable:!0,get:M})},a.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},a.t=function(i,c){if(c&1&&(i=a(i)),c&8||c&4&&typeof i=="object"&&i&&i.__esModule)return i;var M=Object.create(null);if(a.r(M),Object.defineProperty(M,"default",{enumerable:!0,value:i}),c&2&&typeof i!="string")for(var w in i)a.d(M,w,(function(C){return i[C]}).bind(null,w));return M},a.n=function(i){var c=i&&i.__esModule?function(){return i.default}:function(){return i};return a.d(c,"a",c),c},a.o=function(i,c){return Object.prototype.hasOwnProperty.call(i,c)},a.p="",a(a.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(l,r,a){a.r(r);var i=a("react"),c=function(){var g=function(d,e){return g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])},g(d,e)};return function(d,e){g(d,e);function t(){this.constructor=d}d.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),M=function(){return M=Object.assign||function(g){for(var d,e=1,t=arguments.length;e<t;e++){d=arguments[e];for(var o in d)Object.prototype.hasOwnProperty.call(d,o)&&(g[o]=d[o])}return g},M.apply(this,arguments)},w=function(g,d){var e={};for(var t in g)Object.prototype.hasOwnProperty.call(g,t)&&d.indexOf(t)<0&&(e[t]=g[t]);if(g!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,t=Object.getOwnPropertySymbols(g);o<t.length;o++)d.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(g,t[o])&&(e[t[o]]=g[t[o]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(d){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,o){e.call(navigator,d,t,o)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function C(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var z=function(g){c(d,g);function d(e){var t=g.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return d.prototype.componentDidMount=function(){var e=this,t=e.state,o=e.props;if(this.unmounted=!1,!C()){o.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),o.children&&typeof o.children!="function"&&console.warn("children must be a function")},d.prototype.componentDidUpdate=function(e){var t=this.props;if(!C()){t.onUserMediaError("getUserMedia not supported");return}var o=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),n=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),v=e.minScreenshotWidth!==t.minScreenshotWidth,f=e.minScreenshotHeight!==t.minScreenshotHeight;(n||v||f)&&(this.canvas=null,this.ctx=null),(o||n)&&(this.stopAndCleanup(),this.requestUserMedia())},d.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},d.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},d.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(d.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},d.prototype.getScreenshot=function(e){var t=this,o=t.state,n=t.props;if(!o.hasUserMedia)return null;var v=this.getCanvas(e);return v&&v.toDataURL(n.screenshotFormat,n.screenshotQuality)},d.prototype.getCanvas=function(e){var t=this,o=t.state,n=t.props;if(!this.video||!o.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var v=this.video.videoWidth,f=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var h=v/f;v=n.minScreenshotWidth||this.video.clientWidth,f=v/h,n.minScreenshotHeight&&f<n.minScreenshotHeight&&(f=n.minScreenshotHeight,v=f*h)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||v,this.canvas.height=(e==null?void 0:e.height)||f,this.ctx=this.canvas.getContext("2d")}var S=this,y=S.ctx,p=S.canvas;return y&&p&&(p.width=(e==null?void 0:e.width)||p.width,p.height=(e==null?void 0:e.height)||p.height,n.mirrored&&(y.translate(p.width,0),y.scale(-1,1)),y.imageSmoothingEnabled=n.imageSmoothing,y.drawImage(this.video,0,0,(e==null?void 0:e.width)||p.width,(e==null?void 0:e.height)||p.height),n.mirrored&&(y.scale(-1,1),y.translate(-p.width,0))),p},d.prototype.requestUserMedia=function(){var e=this,t=this.props,o=function(f,h){var S={video:typeof h<"u"?h:!0};t.audio&&(S.audio=typeof f<"u"?f:!0),e.requestUserMediaId++;var y=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(S).then(function(p){e.unmounted||y!==e.requestUserMediaId?d.stopMediaStream(p):e.handleUserMedia(null,p)}).catch(function(p){e.handleUserMedia(p)})};if("mediaDevices"in navigator)o(t.audioConstraints,t.videoConstraints);else{var n=function(f){return{optional:[{sourceId:f}]}},v=function(f){var h=f.deviceId;return typeof h=="string"?h:Array.isArray(h)&&h.length>0?h[0]:typeof h=="object"&&h.ideal?h.ideal:null};MediaStreamTrack.getSources(function(f){var h=null,S=null;f.forEach(function(_){_.kind==="audio"?h=_.id:_.kind==="video"&&(S=_.id)});var y=v(t.audioConstraints);y&&(h=y);var p=v(t.videoConstraints);p&&(S=p),o(n(h),n(S))})}},d.prototype.handleUserMedia=function(e,t){var o=this.props;if(e||!t){this.setState({hasUserMedia:!1}),o.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}o.onUserMedia(t)},d.prototype.render=function(){var e=this,t=this,o=t.state,n=t.props,v=n.audio;n.forceScreenshotSourceSize,n.onUserMedia,n.onUserMediaError,n.screenshotFormat,n.screenshotQuality,n.minScreenshotWidth,n.minScreenshotHeight,n.audioConstraints,n.videoConstraints,n.imageSmoothing;var f=n.mirrored,h=n.style,S=h===void 0?{}:h,y=n.children,p=w(n,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),_=f?M(M({},S),{transform:(S.transform||"")+" scaleX(-1)"}):S,U={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",M({autoPlay:!0,src:o.src,muted:!v,playsInline:!0,ref:function(b){e.video=b},style:_},p)),y&&y(U))},d.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},d}(i.Component);r.default=z},react:function(l,r){l.exports=u}}).default})})(q);var Y=q.exports;const Z=$(Y);var F={},H={},N={},G={};G.getMatches=s=>typeof window<"u"?window.matchMedia(s).matches:!1;N.getMatches=G.getMatches;const{useState:ee,useLayoutEffect:te,useEffect:ie}=x,{getMatches:re}=N,ne=typeof window<"u",oe=ne?te:ie,ae=(s="")=>{const[m,u]=ee(re(s));return oe(()=>{let l=!0;const r=window.matchMedia(s.replace(/^@media\s*/,"")),a=()=>{l&&u(r.matches)};return r.addListener?r.addListener(a):r.addEventListener("change",a),u(r.matches),()=>{l=!1,r.addListener?r.removeListener(a):r.removeEventListener("change",a)}},[s]),m};H.useMediaQuery=ae;F.useMediaQuery=H.useMediaQuery;var R=F.useMediaQuery;const se=()=>{let s=!1,m=!1,u=!1,l=!1,r=!1,a=!1;const i=J();return i!=null&&i.breakpoints&&(s=R(i.breakpoints.only("xs")),m=R(i.breakpoints.only("sm")),u=R(i.breakpoints.only("md")),l=R(i.breakpoints.only("lg")),r=R(i.breakpoints.only("xl")),a=R(i.breakpoints.only("xxl"))),{isXs:s,isSm:m,isMd:u,isLg:l,isXl:r,isXxl:a}},de=(s,m=null)=>{const u=x.useRef(m);return x.useEffect(()=>{s&&(typeof s=="function"?s(u.current):s.current=u.current)},[s]),u},ce=s=>{let m={isRunning:!1,callback:s};return async function(...u){m.isRunning||(m.isRunning=!0,await m.callback(...u),m.isRunning=!1)}},T=(s,m)=>setInterval(ce(s),m),X="user",ue="videoinput",le=async()=>{let s=[];(await navigator.mediaDevices.enumerateDevices()).forEach(l=>{if(l.kind!==ue)return;const r=l;r&&s.push(r)});let u=[];return s.forEach(l=>{const r=l.getCapabilities(),a={inputDeviceInfo:l,mediaTrackCapabilities:r};u.push(a)}),console.log("video inputs",u),u},fe=async()=>{const s=[];return(await le()).forEach(u=>{const l=u.inputDeviceInfo,r=u.mediaTrackCapabilities,a=r.facingMode;if(a&&a.length)a.forEach(i=>{const c={deviceId:l.deviceId,facingMode:i,label:l.label,aspectRatio:r.aspectRatio,width:r.width,height:r.height};s.push(c)});else{const i={deviceId:u.inputDeviceInfo.deviceId,facingMode:X,label:u.inputDeviceInfo.label,aspectRatio:r.aspectRatio,width:r.width,height:r.height};s.push(i)}}),s},he=E.div`
  position: relative;
  padding: 1rem;
  margin-bottom: 1rem;
  background-color: #1D1E20;
  border-radius: 4px;
`,pe=E.div`
  margin-bottom: 10px;
`,ve=E.div`
  position: relative;
`,ge=E(Z)`
  position: relative;
  top: 0;
  left: 0;
`,me=E(K)`
  float: right;
`,ye=E.span`
  font-size: 12px;
  line-height: 1;
`,k=x.forwardRef(({children:s,onInitialized:m,onSizeChange:u},l)=>{const r=de(l),[a,i]=x.useState(!1),[c,M]=x.useState([]),[w,C]=x.useState(null),{isXs:z,isSm:g,isMd:d,isLg:e,isXl:t,isXxl:o}=se();let n=640,v=480;z||g?(n=320,v=240):d||e?(n=576,v=432):(t||o)&&(n=640,v=480);let f={facingMode:X,width:{max:n},height:{max:v}};w&&(f.deviceId=w.deviceId,f.facingMode=w.facingMode);let h=c.length;const S=()=>{let U=!1,b=T(async()=>{const I=r==null?void 0:r.current;if(!I)return;const O=I==null?void 0:I.video;if(O&&O.readyState===4&&!a){if(!U){console.log("initializing video"),U=!0;const V=await fe(),L=V[0];console.log("initializing video input modes",V),M(V),console.log("initializing default video input mode",L),C(L),console.log("initialized video"),i(!0),m()}clearInterval(b)}},100)},y=async()=>{const U=r==null?void 0:r.current;if(!U)return;const b=U==null?void 0:U.video;if(!b||b.readyState!==4)return;const I=b.videoWidth,O=b.videoHeight;(b.width!==I||b.height!==O)&&(b.width=I,b.height=O,u(I,O))},p=()=>{if(!c||!w)return;let b=c.indexOf(w)+1;b>=c.length&&(b=0);const I=c.at(b);I&&C(I)},_=()=>{p()};return x.useEffect(()=>{a?T(async()=>{await y()},10):S()},[a]),P(he,{children:[P(pe,{children:[w&&W(ye,{children:w.label}),h>1&&W(me,{variant:"small",primary:!0,onClick:_,children:"Switch camera"})]}),P(ve,{children:[W(ge,{ref:r,muted:!0,width:n,height:v,videoConstraints:f}),s]})]})});try{k.displayName="RoboflowWebcam",k.__docgenInfo={description:"",displayName:"RoboflowWebcam",props:{onInitialized:{defaultValue:null,description:"",name:"onInitialized",required:!1,type:{name:"(() => void)"}},onSizeChange:{defaultValue:null,description:"",name:"onSizeChange",required:!1,type:{name:"((width: number, height: number) => void)"}}}}}catch{}const _e={component:k,title:"gle-roboflow-components/RoboflowWebcam",argTypes:{}},Me=E.div`
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  margin: 1rem 0;
`,be=s=>W(Me,{children:W(k,{})}),j=s=>W(be,{...s});j.args={};var D,Q,A;j.parameters={...j.parameters,docs:{...(D=j.parameters)==null?void 0:D.docs,source:{originalSource:"(args: RoboflowWebcamProps) => <StoryTemplate {...args} />",...(A=(Q=j.parameters)==null?void 0:Q.docs)==null?void 0:A.source}}};const Ce=["Default"];export{j as Default,Ce as __namedExportsOrder,_e as default};
//# sourceMappingURL=RoboflowWebcam.stories-c29d626b.js.map
