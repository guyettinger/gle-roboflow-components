import{J as $,s as C,a as L,j as R}from"./styled-components.browser.esm-5c00f201.js";import{r as x}from"./index-76fb7be0.js";import{c as K,g as Y}from"./_commonjsHelpers-de833af9.js";import{C as Z}from"./index-2384fde8.js";import"./index-d3ea75b5.js";var q={exports:{}};(function(s,g){(function(l,r){s.exports=r(x)})(K,function(c){return function(l){var r={};function a(i){if(r[i])return r[i].exports;var u=r[i]={i,l:!1,exports:{}};return l[i].call(u.exports,u,u.exports,a),u.l=!0,u.exports}return a.m=l,a.c=r,a.d=function(i,u,M){a.o(i,u)||Object.defineProperty(i,u,{enumerable:!0,get:M})},a.r=function(i){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},a.t=function(i,u){if(u&1&&(i=a(i)),u&8||u&4&&typeof i=="object"&&i&&i.__esModule)return i;var M=Object.create(null);if(a.r(M),Object.defineProperty(M,"default",{enumerable:!0,value:i}),u&2&&typeof i!="string")for(var S in i)a.d(M,S,(function(O){return i[O]}).bind(null,S));return M},a.n=function(i){var u=i&&i.__esModule?function(){return i.default}:function(){return i};return a.d(u,"a",u),u},a.o=function(i,u){return Object.prototype.hasOwnProperty.call(i,u)},a.p="",a(a.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(l,r,a){a.r(r);var i=a("react"),u=function(){var m=function(d,e){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o])},m(d,e)};return function(d,e){m(d,e);function t(){this.constructor=d}d.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}}(),M=function(){return M=Object.assign||function(m){for(var d,e=1,t=arguments.length;e<t;e++){d=arguments[e];for(var n in d)Object.prototype.hasOwnProperty.call(d,n)&&(m[n]=d[n])}return m},M.apply(this,arguments)},S=function(m,d){var e={};for(var t in m)Object.prototype.hasOwnProperty.call(m,t)&&d.indexOf(t)<0&&(e[t]=m[t]);if(m!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,t=Object.getOwnPropertySymbols(m);n<t.length;n++)d.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(m,t[n])&&(e[t[n]]=m[t[n]]);return e};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(d){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?new Promise(function(t,n){e.call(navigator,d,t,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function O(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var V=function(m){u(d,m);function d(e){var t=m.call(this,e)||this;return t.canvas=null,t.ctx=null,t.requestUserMediaId=0,t.unmounted=!1,t.state={hasUserMedia:!1},t}return d.prototype.componentDidMount=function(){var e=this,t=e.state,n=e.props;if(this.unmounted=!1,!O()){n.onUserMediaError("getUserMedia not supported");return}t.hasUserMedia||this.requestUserMedia(),n.children&&typeof n.children!="function"&&console.warn("children must be a function")},d.prototype.componentDidUpdate=function(e){var t=this.props;if(!O()){t.onUserMediaError("getUserMedia not supported");return}var n=JSON.stringify(e.audioConstraints)!==JSON.stringify(t.audioConstraints),o=JSON.stringify(e.videoConstraints)!==JSON.stringify(t.videoConstraints),v=e.minScreenshotWidth!==t.minScreenshotWidth,f=e.minScreenshotHeight!==t.minScreenshotHeight;(o||v||f)&&(this.canvas=null,this.ctx=null),(n||o)&&(this.stopAndCleanup(),this.requestUserMedia())},d.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},d.stopMediaStream=function(e){e&&(e.getVideoTracks&&e.getAudioTracks?(e.getVideoTracks().map(function(t){e.removeTrack(t),t.stop()}),e.getAudioTracks().map(function(t){e.removeTrack(t),t.stop()})):e.stop())},d.prototype.stopAndCleanup=function(){var e=this.state;e.hasUserMedia&&(d.stopMediaStream(this.stream),e.src&&window.URL.revokeObjectURL(e.src))},d.prototype.getScreenshot=function(e){var t=this,n=t.state,o=t.props;if(!n.hasUserMedia)return null;var v=this.getCanvas(e);return v&&v.toDataURL(o.screenshotFormat,o.screenshotQuality)},d.prototype.getCanvas=function(e){var t=this,n=t.state,o=t.props;if(!this.video||!n.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var v=this.video.videoWidth,f=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var p=v/f;v=o.minScreenshotWidth||this.video.clientWidth,f=v/p,o.minScreenshotHeight&&f<o.minScreenshotHeight&&(f=o.minScreenshotHeight,v=f*p)}this.canvas=document.createElement("canvas"),this.canvas.width=(e==null?void 0:e.width)||v,this.canvas.height=(e==null?void 0:e.height)||f,this.ctx=this.canvas.getContext("2d")}var w=this,y=w.ctx,h=w.canvas;return y&&h&&(h.width=(e==null?void 0:e.width)||h.width,h.height=(e==null?void 0:e.height)||h.height,o.mirrored&&(y.translate(h.width,0),y.scale(-1,1)),y.imageSmoothingEnabled=o.imageSmoothing,y.drawImage(this.video,0,0,(e==null?void 0:e.width)||h.width,(e==null?void 0:e.height)||h.height),o.mirrored&&(y.scale(-1,1),y.translate(-h.width,0))),h},d.prototype.requestUserMedia=function(){var e=this,t=this.props,n=function(f,p){var w={video:typeof p<"u"?p:!0};t.audio&&(w.audio=typeof f<"u"?f:!0),e.requestUserMediaId++;var y=e.requestUserMediaId;navigator.mediaDevices.getUserMedia(w).then(function(h){e.unmounted||y!==e.requestUserMediaId?d.stopMediaStream(h):e.handleUserMedia(null,h)}).catch(function(h){e.handleUserMedia(h)})};if("mediaDevices"in navigator)n(t.audioConstraints,t.videoConstraints);else{var o=function(f){return{optional:[{sourceId:f}]}},v=function(f){var p=f.deviceId;return typeof p=="string"?p:Array.isArray(p)&&p.length>0?p[0]:typeof p=="object"&&p.ideal?p.ideal:null};MediaStreamTrack.getSources(function(f){var p=null,w=null;f.forEach(function(_){_.kind==="audio"?p=_.id:_.kind==="video"&&(w=_.id)});var y=v(t.audioConstraints);y&&(p=y);var h=v(t.videoConstraints);h&&(w=h),n(o(p),o(w))})}},d.prototype.handleUserMedia=function(e,t){var n=this.props;if(e||!t){this.setState({hasUserMedia:!1}),n.onUserMediaError(e);return}this.stream=t;try{this.video&&(this.video.srcObject=t),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(t)})}n.onUserMedia(t)},d.prototype.render=function(){var e=this,t=this,n=t.state,o=t.props,v=o.audio;o.forceScreenshotSourceSize,o.onUserMedia,o.onUserMediaError,o.screenshotFormat,o.screenshotQuality,o.minScreenshotWidth,o.minScreenshotHeight,o.audioConstraints,o.videoConstraints,o.imageSmoothing;var f=o.mirrored,p=o.style,w=p===void 0?{}:p,y=o.children,h=S(o,["audio","forceScreenshotSourceSize","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),_=f?M(M({},w),{transform:(w.transform||"")+" scaleX(-1)"}):w,I={getScreenshot:this.getScreenshot.bind(this)};return i.createElement(i.Fragment,null,i.createElement("video",M({autoPlay:!0,src:n.src,muted:!v,playsInline:!0,ref:function(b){e.video=b},style:_},h)),y&&y(I))},d.defaultProps={audio:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},d}(i.Component);r.default=V},react:function(l,r){l.exports=c}}).default})})(q);var ee=q.exports;const te=Y(ee);var F={},N={},G={},X={};X.getMatches=s=>typeof window<"u"?window.matchMedia(s).matches:!1;G.getMatches=X.getMatches;const{useState:ie,useLayoutEffect:re,useEffect:oe}=x,{getMatches:ne}=G,ae=typeof window<"u",se=ae?re:oe,de=(s="")=>{const[g,c]=ie(ne(s));return se(()=>{let l=!0;const r=window.matchMedia(s.replace(/^@media\s*/,"")),a=()=>{l&&c(r.matches)};return r.addListener?r.addListener(a):r.addEventListener("change",a),c(r.matches),()=>{l=!1,r.addListener?r.removeListener(a):r.removeEventListener("change",a)}},[s]),g};N.useMediaQuery=de;F.useMediaQuery=N.useMediaQuery;var W=F.useMediaQuery;const ce=()=>{let s=!1,g=!1,c=!1,l=!1,r=!1,a=!1;const i=$();return i!=null&&i.breakpoints&&(s=W(i.breakpoints.only("xs")),g=W(i.breakpoints.only("sm")),c=W(i.breakpoints.only("md")),l=W(i.breakpoints.only("lg")),r=W(i.breakpoints.only("xl")),a=W(i.breakpoints.only("xxl"))),{isXs:s,isSm:g,isMd:c,isLg:l,isXl:r,isXxl:a}},ue=(s,g=null)=>{const c=x.useRef(g);return x.useEffect(()=>{s&&(typeof s=="function"?s(c.current):s.current=c.current)},[s]),c},le=s=>{let g={isRunning:!1,callback:s};return async function(...c){g.isRunning||(g.isRunning=!0,await g.callback(...c),g.isRunning=!1)}},D=(s,g)=>setInterval(le(s),g),z="user",fe="videoinput",pe=async()=>{let s=[];(await navigator.mediaDevices.enumerateDevices()).forEach(l=>{if(l.kind!==fe)return;const r=l;r&&s.push(r)});let c=[];return s.forEach(l=>{const r=l.getCapabilities(),a={inputDeviceInfo:l,mediaTrackCapabilities:r};c.push(a)}),console.log("video inputs",c),c},he=async()=>{const s=[];return(await pe()).forEach(c=>{const l=c.inputDeviceInfo,r=c.mediaTrackCapabilities,a=r.facingMode;if(a&&a.length)a.forEach(i=>{const u={deviceId:l.deviceId,facingMode:i,label:l.label,aspectRatio:r.aspectRatio,width:r.width,height:r.height};s.push(u)});else{const i={deviceId:c.inputDeviceInfo.deviceId,facingMode:z,label:c.inputDeviceInfo.label,aspectRatio:r.aspectRatio,width:r.width,height:r.height};s.push(i)}}),s},ve=C.div`
  position: relative;
  padding: 1rem;
  margin-bottom: 1rem;
  background-color: #1D1E20;
  border-radius: 4px;
`,ge=C.div`
  margin-bottom: 10px;
`,me=C.div`
  position: relative;
`,ye=C(te)`
  position: relative;
  top: 0;
  left: 0;
`,Me=C(Z)`
  float: right;
`,be=C.span`
  font-size: 12px;
  line-height: 1;
`,k=x.forwardRef(({children:s,onInitialized:g,onSizeChange:c},l)=>{const r=ue(l),[a,i]=x.useState(!1),[u,M]=x.useState([]),[S,O]=x.useState(null),{isXs:V,isSm:m,isMd:d,isLg:e,isXl:t,isXxl:n}=ce();let o=640,v=480;V||m?(o=320,v=240):d||e?(o=576,v=432):(t||n)&&(o=640,v=480);let f={facingMode:z,width:{max:o},height:{max:v}};S&&(f.deviceId=S.deviceId,f.facingMode=S.facingMode);let p=u.length;const w=()=>{let I=!1,b=D(async()=>{const U=r==null?void 0:r.current;if(!U)return;const E=U==null?void 0:U.video;if(E&&E.readyState===4&&!a){if(!I){console.log("initializing video"),I=!0;const P=await he(),T=P[0];console.log("initializing video input modes",P),M(P),console.log("initializing default video input mode",T),O(T),console.log("initialized video"),i(!0),g==null||g();const J=E.videoWidth,B=E.videoHeight;c==null||c(J,B)}clearInterval(b)}},100)},y=async()=>{const I=r==null?void 0:r.current;if(!I)return;const b=I==null?void 0:I.video;if(!b||b.readyState!==4)return;const U=b.videoWidth,E=b.videoHeight;(b.width!==U||b.height!==E)&&(b.width=U,b.height=E,c==null||c(U,E))},h=()=>{if(!u||!S)return;let b=u.indexOf(S)+1;b>=u.length&&(b=0);const U=u.at(b);U&&O(U)},_=()=>{h()};return x.useEffect(()=>{a?D(async()=>{await y()},10):w()},[a]),L(ve,{children:[L(ge,{children:[S&&R(be,{children:S.label}),p>1&&R(Me,{variant:"small",primary:!0,onClick:_,children:"Switch camera"})]}),L(me,{children:[R(ye,{ref:r,muted:!0,width:o,height:v,videoConstraints:f}),s]})]})});try{k.displayName="RoboflowWebcam",k.__docgenInfo={description:"",displayName:"RoboflowWebcam",props:{onInitialized:{defaultValue:null,description:"",name:"onInitialized",required:!1,type:{name:"(() => void)"}},onSizeChange:{defaultValue:null,description:"",name:"onSizeChange",required:!1,type:{name:"((width: number, height: number) => void)"}}}}}catch{}const Oe={component:k,title:"gle-roboflow-components/RoboflowWebcam",argTypes:{}},we=C.div`
  color: white;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  margin: 1rem 0;
`,Se=s=>R(we,{children:R(k,{})}),j=s=>R(Se,{...s});j.args={};var Q,A,H;j.parameters={...j.parameters,docs:{...(Q=j.parameters)==null?void 0:Q.docs,source:{originalSource:"(args: RoboflowWebcamProps) => <StoryTemplate {...args} />",...(H=(A=j.parameters)==null?void 0:A.docs)==null?void 0:H.source}}};const Ce=["Default"];export{j as Default,Ce as __namedExportsOrder,Oe as default};
//# sourceMappingURL=RoboflowWebcam.stories-7f6799da.js.map
